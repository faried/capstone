# Udacity Blockchain Capstone

## Addresses and Deployment

On Rinkeby, the Verifier contract generated by ZoKrates is deployed
at
[0x8a70fa6d40e6730403e4d859283db464b14ac596](https://rinkeby.etherscan.io/address/0x8a70fa6d40e6730403e4d859283db464b14ac596)
and SolnSquareVerifier is deployed at
[0x14A95F5b92a366ED5e4d6D8d41B4d3D6C91d05e8](https://rinkeby.etherscan.io/address/0x14A95F5b92a366ED5e4d6D8d41B4d3D6C91d05e8).

The deployment address is
[0xaD982564F83bCCd9e424c4026e8199991Adfce81](https://rinkeby.etherscan.io/address/0xaD982564F83bCCd9e424c4026e8199991Adfce81).

Since `SolnSquareVerifier` depends on the `Verifier` contract,
`migrations/2_deploy_contracts.js` was modified to pass
`Verifier.address` to `SolnSquareVerifier`.

## Token

The name of the token is
[SleepyToken](https://rinkeby.etherscan.io/token/0x14a95f5b92a366ed5e4d6d8d41b4d3d6c91d05e8)
(symbol: STT).

## Minting Tokens

Ten tokens were minted to various MetaMask accounts:

| Token | Account | Proof File | Transaction ID |
|---|---|---|---|
| 1 | 0xad982564f83bccd9e424c4026e8199991adfce81 | prod-proof-10.json | 0xf95e838eb8965f880ba4d87c0ba06f91189f916fd72aaba12f7d36f5b2f0854c |
| 2 | 0xc64418B0Be025Fde0ecBE7dBaAe57deb15e3D6eD | prod-proof-11.json | 0x468643e84b799d644f787c297c6fbeaa4ca335bbf1f2efed9c9606ba0c444bf7 |
| 3 | 0x05323D860a848E70054138d1dcd5a19E203F725d | test-proof-2.json | 0x14fe08f029907e88342e2780effceef23e8b95dd32b17bc17d8f0632ad4f781f |
| 4 | 0x018C2daBef4904ECbd7118350A0c54DbeaE3549A | prod-proof-13.json | 0x65b6f9786b2067ef5946ef5525a7060e2684a5b95a167235e5cf263021a9ebba |
| 5 | 0x018C2daBef4904ECbd7118350A0c54DbeaE3549A | prod-proof-14.json | 0xa7aa4b1ee3e85b482c82ec42935eccfd48166304488e940f45234cea24d273e3 |
| 6 | 0x018C2daBef4904ECbd7118350A0c54DbeaE3549A | prod-proof-15.json | 0x6ee5addaeb1e82cedf46d5ccd8ed018b9032f5108f3b9aae0ae44569fe32c7b0 |
| 7 | 0xD37b7B8C62BE2fdDe8dAa9816483AeBDBd356088 | prod-proof-16.json | 0x31231c623f2203b8bef6cd96c29722cae1f78a2af94ae63d40d290a0ea682e52 |
| 8 | 0xD37b7B8C62BE2fdDe8dAa9816483AeBDBd356088 | prod-proof-17.json | 0x9e247475d9ac946dd041ec5a98f0ba13c8baa1c1971858e155576b74e9be5bc9 |
| 9 | 0xaD982564F83bCCd9e424c4026e8199991Adfce81 | prod-proof-18.json | 0x94bedef3e9de07aa1744b7a8013b7c9d3b1af05e626f63960d08755733da414f |
| 10 | 0xaD982564F83bCCd9e424c4026e8199991Adfce81 | prod-proof-19.json | 0x070decae7b6cb7445bb0fc1805a70c1a1a0b82fe8c6b0feca73896b4921c519c |

The tokens were minted manually; I couldn't find a good way to get
`truffle` or some other tool to automate the process.  To mint them,
I'd go to the [write contract page on
etherscan](https://rinkeby.etherscan.io/token/0x14a95f5b92a366ed5e4d6d8d41b4d3d6c91d05e8#writeContract),
and copy/paste the appropriate values from the generated proof files
into the form fields.  This process took a while, and was error-prone;
several transactions failed because I copied/pasted the wrong values.

## Proof Files

For use in testing and to mint the initial tokens, twenty proofs were
generated.  They are in the `zokrates/code/square/proofs` directory.
Due to an error made while minting the tokens manually,
`test-proof-2.json` was used instead of `prod-proof-12.json`.

After running these steps under docker

    ~/zokrates compile -i square.code
    ~/zokrates setup

I generated the test/prod proofs with

    mkdir proofs

    for i in `seq 0 9`; do
      ~/zokrates compute-witness -o proofs/test-witness.$i -a $i $((i*i))
      ~/zokrates generate-proof -j proofs/test-proof-$i.json -w proofs/test-witness.$i
    done

    for i in `seq 10 19`; do
      ~/zokrates compute-witness -o proofs/prod-witness.$i -a $i $((i*i))
      ~/zokrates generate-proof -j proofs/prod-proof-$i.json -w proofs/prod-witness.$i
    done

## OpenSea

The storefront is at
[https://rinkeby.opensea.io/storefront/sleepytoken-2](https://rinkeby.opensea.io/storefront/sleepytoken-2).
I tested transferring tokens #2, #3, #6, #8, and #9 between accounts.

## Testing

In the `eth-contracts` directory, with `ganache-cli` (or some other
client) running on port 8545, run the tests with

    for t in test/*.js; do
      truffle test $t
    done

### TestERC721Mintable.js

* contract should return total supply
* contract should get token balance
* contract should return token uri
* contract should transfer token from one owner to another
* contract should fail when minting when address is not contract owner
* contract should return contract owner

### TestERC721Pause.js

* contract not paused: can mint a token
* contract paused: cannot mint a token
* contract not paused: should transfer token from one owner to another
* contract paused: should not transfer token from one owner to another

### TestERC721Transfer.js

* approve a valid transfer
* verify a valid transfer is set up
* actually perform the transfer
* forbid transfer to yourself
* forbid transfer by third party
* allow a certain account the ability to transfer tokens
* allow transfer by third party
* verify a valid third-party transfer is set up

### TestSolnSquareVerifier.js

* contract starts with no solutions
* can mint a token
* contract should have one solution now
* contract cannot mint a token against existing solution
* contract can mint a second token
* contract should have two solutions now

### TestSquareVerifier.js

* verifier contract can verify proper input
* bad input values should fail to verify
